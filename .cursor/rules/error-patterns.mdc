---
description: Common error patterns and anti-patterns to avoid when building BraveUniverse facets.
globs:
  - "**/*.sol"
mode: always
---

# ERROR PATTERNS

## ğŸ”’ Access Control Issues
- Using `msg.sender` directly instead of abstracted access control layer.
- Forgetting to check `isContract()` when calling external addresses.

## ğŸ’¾ Storage Collision
- Multiple facets writing to the same slot without namespacing.
- Not using a dedicated `LibXYZStorage.layout()` with fixed slot.

## ğŸ§® Math Errors
- Unsafe arithmetic (overflow/underflow) without `SafeMath`.
- Using division without zero-check.

## ğŸ§  Logic Bugs
- Reentrancy via unguarded `external` call before state update.
- Relying on `block.timestamp` for randomness.

## ğŸ§ª Test Gaps
- Not testing with multiple users (UP1, UP2, attacker).
- Skipping invalid input / edge case scenarios.

## ğŸ” Gas Regressions
- Adding unnecessary state writes in hot paths.
- Event logging excessive values.

## ğŸ—‘ Bad Cleanup
- Leaving dev `console.log()` in BUILD_READY commits.
- Commented-out dead code not removed.

# POLICY
When a new error occurs during development or test failure:
- Add a new item to this file with the category, pattern, and fix.
- Avoid repeating same issue in future facets.
- Use `error-patterns` as part of agent sanity checklist.
