---
description: Background Agent task execution pipeline for BraveUniverse.
globs:
  - "**/*.sol"
mode: always
---

# AGENT FLOW
Defines the exact execution logic the Background Agent must follow.

## Step-by-step:

1. **Receive Task**: Parse topic and facet name from prompt.
2. **Interpret Topic**: Use available `.mdc` templates and past facet structure.
3. **Generate Facet**:
   - Contract file with accurate naming.
   - Interface file.
   - Storage library only if necessary.
4. **Write Full Test Suite**:
   - Multi-user, access control, edge case, and token-flow scenarios.
   - Tests must simulate realistic scenarios using Hardhat on LUKSO Testnet.
   - Use multiple wallet accounts.
5. **Deploy to Testnet**:
   - Deploy facet individually via hardhat script.
   - Store address in `/deployments/staging/addresses.json`.
6. **Run Tests**:
   - If tests fail, iterate and fix.
   - Repeat until all tests pass.
7. **If tests pass**:
   - Generate and export ABI to `/abis`.
   - Update `FacetMap`.
   - Update `facet-status` JSON.
   - Mark checklist items.
8. **Mark BUILD_READY**: Only then finalize the facet.
